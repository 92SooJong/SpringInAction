<!DOCTYPE html>
<html>
<body>

<h1>The onclick Event</h1>
<p>The onclick event is used to trigger a function when an element is clicked on.</p>
<input id="input_fileName" type="text" />
<button onclick="myFunction()">파일 불러오기</button> 
<input id="input_tableName" type="text" />
<button onclick="createInsertSentence()">INSERT문 생성</button>


<table id="table" border="1" >
</table>



<div id="resultQuery"></div>



<script>
    var allPageNo = 0;

    // 파일 불러오기
    function myFunction() {
        var input = document.createElement("input");
        input.type = "file";
        input.accept = ".csv"; 
        input.onchange = function (event) {
            processFile(event.target.files[0]);
        };
        input.click();
    }

    // 파일값 가져오기
    function processFile(file) {
        
        var reader = new FileReader();
        reader.onload = function () {
            var fileNameCmp = document.getElementById("input_fileName");       
            fileNameCmp.value = file.name;
            fileNameCmp.readOnly = true;
            drawTable(reader.result);
            
        };
        reader.readAsText(file, /* optional */ "euc-kr");
    }

    // 파일값 입력으로 받아서 table에 그리기
    function drawTable(result){
        var table = document.getElementById('table'); 
        
        rows = result.split('\n');
        drawTableHeader(rows[0].split('\t'))
        for(var i=1; i<rows.length-1; i++){
            drawTableRow(rows[i].split('\t'),i);
        }
        drawPageNumberButton(rows.length,20);

    }

    // td 그리기
    function drawTableRow(tdList,rownum){
        var td = ''
        var style = "";

        // 갯수를 20개까지만 화면에 출력한다. 나머지는 숨김처리
        if(rownum > 20){
            var style = 'style = "display:none;"';
        } 
        
        td += `<tr id="tr_"${rownum} ${style}>`
        for(var i=0; i<tdList.length; i++){
            td += `<td id=td_`+rownum+`_`+i+`>${tdList[i]}</td>`; 
        }
        td += `</tr>`
        table.innerHTML += td;
        
    }

    // th 그리기
    function drawTableHeader(headList){
        var head = ''
        
        for(var i=0; i<headList.length; i++){
            head += `<th id=th_0_`+i.toString()+`>${headList[i]}</th>`;
        }
        table.innerHTML += head;
    }

    // Insert 쿼리 작성
    function createInsertSentence(){
        var tableNameObj = document.getElementById("input_tableName");
        if(tableNameObj.value == "") {
            alert("테이블 명이 입력되지 않았습니다.")
            return;
        }
        var headerList = getTableTh();
        var tableName = tableNameObj.value;
        var prefix = "INSERT INTO ";
        var surfix = " VALUES";

        // INSERT INTO 테이블명 ( 컬럼1, 컬럼2, 컬럼3... ) VALUES (데이터1, 데이터2, 데이터3 ...);
        var columnNames = coverWithBlank(headerList.join(","));
        var queryPrefix = prefix + tableName + columnNames+surfix;

        var results = getTableTr();

        for(var i =0 ; i<results.length; i++){
            var wholeQuery = "<h>"+queryPrefix.concat(removeEnter(results[i])) + ";</h><br/>";
            document.getElementById("resultQuery").innerHTML += wholeQuery;
        }


    }
    
    function removeEnter(word){
        return word.replace("\n","");
    }


    // 테이블의 th 가져오기.
    function getTableTh(){
        var table = document.getElementById('table');
        var header = table.rows[0].cells;
        var headerList = [];
        for(var i=0; i<header.length; i++){
            console.log(header[i].innerHTML);
            headerList.push(header[i].innerHTML.replace("\n",""));
        }
        return headerList;
    }

    function getTableTr(){
        var table = document.getElementById('table');
        var results = [];
        var rows = table.rows
        for(var i=1; i<rows.length; i++){
            var datas = "";
            var row = rows[i].cells;
            for(var j=0; j<row.length; j++){
                var comma = ","
                if(j == row.length - 1) comma =""
                datas += row[j].innerHTML + comma;
            }
            results.push(coverWithBlank(datas));
        }

        return results;

    }

    function drawPageNumberButton(counts,splitNum){
        

        var page = parseInt(counts/splitNum);
        var r = parseInt(counts%splitNum);
        if(r>0) page += 1;

        console.log("총 라인수 " + counts);
        console.log("페이지 수 " + page);

        // 여기서 코드작성
        for(var i =0; i<page; i++){
            console.log(i);
        }


    }


    function coverWithBlank(word){
        return "(".concat(word).concat(")");
    }



</script>

</body>
</html>
